{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandlers.ts", "../src/reactive.ts"],
  "sourcesContent": ["import { ReactiveEffect } from \"vue\";\n\nexport let activeEffect\nclass ReactiveEffect {\n    public active = true\n    public deps = [] // effect\u7684\u4F9D\u8D56\u9879\n    public parent = undefined\n    constructor(public fn) { // public fn, this.fn\n\n    }\n\n    run() {\n        if (!this.active) {\n            return this.fn() // \u672A\u6FC0\u6D3B\u7684\u76F4\u63A5\u6267\u884C\u4E00\u6B21\u51FD\u6570\n        }\n\n        // \u5176\u4ED6\u60C5\u51B5 \u662F\u6FC0\u6D3B\u7684\n        try {\n            this.parent = activeEffect\n            activeEffect = this\n            return this.fn()\n        } finally {\n            activeEffect = this.parent\n            this.parent = undefined\n        }\n\n    }\n}\n\n// \u4F9D\u8D56\u6536\u96C6\uFF0C\u5C06\u5F53\u524D\u7684effect\u653E\u5230\u5168\u5C40\u53D8\u91CF\u4E0A\nexport function effect(fn) {\n    const _effect = new ReactiveEffect(fn) // \u54CD\u5E94\u5F0F\u7684effect\n    _effect.run() // \u521B\u5EFA\u65F6\u9ED8\u8BA4\u6267\u884C\u4E00\u6B21 \n}\n\n// let mapping = {\n//     target1: {\n//         name: [effect1, effect2, ...]\n//     }\n// }\nconst targetMap = new WeakMap()\nexport function track(target, key) {\n    if (!activeEffect) { // \u4E0D\u662F\u5728effect\u4E2D\u53D6\u503C\uFF0C\u4E0D\u9700\u8981\u6536\u96C6\n        return\n    }\n    let depsMap = targetMap.get(target)\n    if (!depsMap) {\n        targetMap.set(target, (depsMap = new Map()))\n    }\n    let dep = depsMap.get(key) // \u8BB0\u5F55\u54EA\u4E9Beffect\u4F9D\u8D56\u8BE5\u5C5E\u6027\n    if (!dep) {\n        depsMap.set(key, (dep = new Set()))\n    }\n    let shouldTrack = dep.has(activeEffect)\n    if(shouldTrack) {\n        dep.add(activeEffect)\n        activeEffect.deps.push(dep) // \u6536\u96C6\u8BE5effect\u4F9D\u8D56\u7684\u5C5E\u6027\n    }\n}\n\n/**\n * // \u8001\u65B9\u6848\uFF1Astack \u4F9D\u8D56\u6536\u96C6\u5904\u7406effect\u5D4C\u5957\u7684\u60C5\u51B5\n * stack = [e1, e2]\n * \n * effect(() => { // e1\n *   proxy.name\n *   effect(() => { // e2\n *      proxy.age\n *   })\n *   proxy.sex\n * })\n */\n\n/**\n * // \u65B0\u65B9\u6848\uFF1A\u6807\u8BB0 \n * activeEffect = e1\n * effect(()) => { e1  e1.parent = null\n *  proxy.name\n *  effect(() => { e2  e2.parent = e1\n *      proxy.age\n *  })\n *  proxy.age activeEffect = e2.parent\n * }\n */", "export function isObject(value) {\n    return value !== null && typeof value === 'object'\n}", "import { activeEffect, track } from \"./effect\"\nimport { ReactiveFlags } from \"./reactive\"\n\nexport const mutableHandlers = {\n    get(target, key, receiver) {\n        // return target[key]\n        console.log(key)\n\n        if (ReactiveFlags.IS_REACIVE === key) { // \n            return true\n        }\n\n        console.log(activeEffect, key)\n        // effect\u91CC\u6709\u54CD\u5E94\u5F0F\u53D8\u91CF\u65F6\uFF0C\u4F1A\u8FDB\u5165\u5230\u8FD9\u91CC\n        track(target, key)\n        return Reflect.get(target, key, receiver) // \u4F1A\u628Athis\u6307\u5411\u4EE3\u7406\u5BF9\u8C61\n    },\n    set(target, key, value, receiver) {\n        // target[key] = value\n        // return true\n        return Reflect.set(target, key, value, receiver)\n    }\n}", "import { isObject } from \"@vue/shared\";\nimport { mutableHandlers } from \"./baseHandlers\";\n\nexport const enum ReactiveFlags {\n    IS_REACIVE = '__v__isReactive', // \u662F\u5426\u5DF2\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\n}\n\n// \u5B58\u50A8\u5DF2\u4EE3\u7406\u7684\u5BF9\u8C61\nconst reactiveMap = new WeakMap() // key\u53EA\u80FD\u662F\u5BF9\u8C61\nexport function reactive(target) {\n    // \u975E\u5BF9\u8C61\u4E0D\u5904\u7406\n    if (!isObject(target)) {\n        return target\n    }\n    \n    // \u662F\u5426\u5DF2\u7ECF\u662F\u4EE3\u7406\u5BF9\u8C61\n    if(target[ReactiveFlags.IS_REACIVE]) { // target\u662F\u666E\u901A\u5BF9\u8C61\u7684\u8BDD\u4E0D\u4F1A\u8FDBget\uFF0Ctarget\u662F\u4EE3\u7406\u5BF9\u8C61\u7684\u8BDD\u4F1A\u8FDBget\n        return target\n    }\n    \n    // \u662F\u5426\u5DF2\u88AB\u4EE3\u7406\u8FC7\n    const exisitsProxy = reactiveMap.get(target)\n    if (exisitsProxy) {\n        return exisitsProxy\n    }\n\n    // \u4EE3\u7406\n    const proxy = new Proxy(target, mutableHandlers)\n\n    // \u7F13\u5B58\n    reactiveMap.set(target, proxy)\n\n    return proxy\n}\n"],
  "mappings": ";AAEO,IAAI;AACX,IAAM,iBAAN,MAAqB;AAAA,EAIjB,YAAmB,IAAI;AAAJ;AAHnB,SAAO,SAAS;AAChB,SAAO,OAAO,CAAC;AACf,SAAO,SAAS;AAAA,EAGhB;AAAA,EAEA,MAAM;AACF,QAAI,CAAC,KAAK,QAAQ;AACd,aAAO,KAAK,GAAG;AAAA,IACnB;AAGA,QAAI;AACA,WAAK,SAAS;AACd,qBAAe;AACf,aAAO,KAAK,GAAG;AAAA,IACnB,UAAE;AACE,qBAAe,KAAK;AACpB,WAAK,SAAS;AAAA,IAClB;AAAA,EAEJ;AACJ;AAGO,SAAS,OAAO,IAAI;AACvB,QAAM,UAAU,IAAI,eAAe,EAAE;AACrC,UAAQ,IAAI;AAChB;AAOA,IAAM,YAAY,oBAAI,QAAQ;AACvB,SAAS,MAAM,QAAQ,KAAK;AAC/B,MAAI,CAAC,cAAc;AACf;AAAA,EACJ;AACA,MAAI,UAAU,UAAU,IAAI,MAAM;AAClC,MAAI,CAAC,SAAS;AACV,cAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,EAC/C;AACA,MAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,MAAI,CAAC,KAAK;AACN,YAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,EACtC;AACA,MAAI,cAAc,IAAI,IAAI,YAAY;AACtC,MAAG,aAAa;AACZ,QAAI,IAAI,YAAY;AACpB,iBAAa,KAAK,KAAK,GAAG;AAAA,EAC9B;AACJ;;;AC1DO,SAAS,SAAS,OAAO;AAC5B,SAAO,UAAU,QAAQ,OAAO,UAAU;AAC9C;;;ACCO,IAAM,kBAAkB;AAAA,EAC3B,IAAI,QAAQ,KAAK,UAAU;AAEvB,YAAQ,IAAI,GAAG;AAEf,+CAAiC,KAAK;AAClC,aAAO;AAAA,IACX;AAEA,YAAQ,IAAI,cAAc,GAAG;AAE7B,UAAM,QAAQ,GAAG;AACjB,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC5C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAG9B,WAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,EACnD;AACJ;;;ACnBO,IAAW,gBAAX,kBAAWA,mBAAX;AACH,EAAAA,eAAA,gBAAa;AADC,SAAAA;AAAA,GAAA;AAKlB,IAAM,cAAc,oBAAI,QAAQ;AACzB,SAAS,SAAS,QAAQ;AAE7B,MAAI,CAAC,SAAS,MAAM,GAAG;AACnB,WAAO;AAAA,EACX;AAGA,MAAG,OAAO,qCAA2B;AACjC,WAAO;AAAA,EACX;AAGA,QAAM,eAAe,YAAY,IAAI,MAAM;AAC3C,MAAI,cAAc;AACd,WAAO;AAAA,EACX;AAGA,QAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAG/C,cAAY,IAAI,QAAQ,KAAK;AAE7B,SAAO;AACX;",
  "names": ["ReactiveFlags"]
}
